{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto space-y-8">
  <div class="bg-white p-10 rounded-[40px] border border-slate-100 shadow-xl shadow-slate-100/50">
    <h3 class="text-2xl font-bold mb-2">WAF Sandbox</h3>
    <p class="text-slate-500 mb-6">Test SQLi and XSS payloads against your live Python firewall engine.</p>

    <form method="post" action="{{ url_for('simulate') }}" class="space-y-6">
      <textarea
        id="payload"
        name="payload"
        rows="4"
        class="w-full bg-slate-50 border border-slate-200 rounded-2xl p-5 font-mono text-sm focus:border-red-400 outline-none"
        placeholder="Enter text or malicious code..."
      >{{ query or '' }}</textarea>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <button type="button" onclick="fillExample('sqli')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">SQLi Example</button>
        <button type="button" onclick="fillExample('xss')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">XSS Example</button>
        <button type="button" onclick="fillExample('path')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">Path Traversal</button>
        <button type="button" onclick="fillExample('cmd')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">Cmd Injection</button>
        <button type="button" onclick="fillExample('ssti')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">SSTI</button>
        <button type="button" onclick="fillExample('nosqli')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">NoSQLi</button>
        <button type="button" onclick="fillExample('xxe')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">XXE</button>
        <button type="button" onclick="fillExample('file')" class="py-3 border border-slate-200 rounded-2xl text-sm font-bold text-slate-600 hover:bg-slate-50">File Inclusion</button>
      </div>

      <button type="submit" class="w-full py-5 bg-red-500 text-white rounded-3xl font-extrabold shadow-xl shadow-red-200 hover:bg-red-600">
        Process Request via Firewall
      </button>
    </form>
  </div>

  {% if query %}
  <div class="p-6 bg-green-50 text-green-700 rounded-3xl font-bold border border-green-100">
    Request accepted by WAF: <code class="font-mono">{{ query }}</code>
  </div>
  {% endif %}
</div>

<script>
  function fillExample(type) {
    const el = document.getElementById("payload");
    if (!el) return;
    if (type === "sqli") el.value = "SELECT * FROM users WHERE id = '1' OR '1' = '1'";
    if (type === "xss") el.value = "<script>alert('XSS Test')<" + "/script>";
    if (type === "path") el.value = "../../etc/passwd";
    if (type === "cmd") el.value = "name=test; whoami";
    if (type === "ssti") el.value = "{{7*7}}";
    if (type === "nosqli") el.value = "{\"username\":{\"$ne\":null},\"password\":{\"$ne\":null}}";
    if (type === "xxe") el.value = "<!DOCTYPE foo [ <!ENTITY xxe SYSTEM \"file:///etc/passwd\"> ]><root>&xxe;</root>";
    if (type === "file") el.value = "page=php://filter/convert.base64-encode/resource=index.php";
  }
</script>
{% endblock %}
